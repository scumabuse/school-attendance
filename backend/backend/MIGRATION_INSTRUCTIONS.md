# Инструкция по применению миграций

## Шаги для применения изменений

### 1. Создание миграции Prisma

Выполните следующие команды в директории `backend/backend`:

```bash
npx prisma migrate dev --name add_dual_late_schedule
```

Это создаст миграцию с:
- Добавлением `DUAL` и `LATE` в enum `AttendanceStatus`
- Добавлением полей `markedAt` и `lateMinutes` в модель `Attendance`
- Созданием новой модели `Schedule`

### 2. Генерация Prisma Client

После успешной миграции сгенерируйте Prisma Client:

```bash
npx prisma generate
```

### 3. Проверка изменений

Убедитесь, что:
- ✅ Миграция применена успешно
- ✅ Prisma Client обновлен
- ✅ Сервер запускается без ошибок

### 4. Что изменилось

#### Backend:
- ✅ Добавлены новые статусы `DUAL` и `LATE` в enum `AttendanceStatus`
- ✅ Добавлены поля `markedAt` и `lateMinutes` в модель `Attendance`
- ✅ Создана модель `Schedule` для расписания групп
- ✅ Обновлена функция `calculateAttendance` для правильного расчета посещаемости
- ✅ Добавлена валидация выходных и праздничных дней
- ✅ Добавлен расчет опозданий на основе расписания
- ✅ Обновлен экспорт Excel с новыми статусами
- ✅ Созданы CRUD роуты для расписания `/api/schedules`

#### Frontend:
- ✅ Добавлены кнопки "Д" (DUAL) и "ОП" (LATE) для отметки посещаемости
- ✅ Добавлена валидация выходных и праздничных дней
- ✅ Добавлено отображение минут опоздания для статуса LATE
- ✅ Обновлена статистика с новыми статусами

## Важные заметки

- Все новые поля (`markedAt`, `lateMinutes`) являются **optional**, поэтому старые данные не будут затронуты
- Для расчета опозданий нужно сначала создать расписание для группы через `/api/schedules`
- Выходные дни (суббота, воскресенье) автоматически блокируются для отметок
- Праздничные дни проверяются через таблицу `holidays`








